# 玉符平台应用权限授权

## 场景介绍

应用权限授权是指管理员将企业业务系统的访问权限赋予用户。随着企业的建设发展，不同组织及岗位的员工会根据自身业务需求自研或外采各类业务系统，灵活且易用的应用权限授权能力让企业的数据安全得到保障的同时，也让员工及管理员的工作效率得到提升。  

本文将介绍企业管理员如何在玉符IDaaS管理后台为应用进行快速授权。

## 预期效果

1. 前提：进行应用权限授权前，请确保已完成以下任务：
   * 已有单点登录应用；
   * 已有人员、部门及用户组数据；

2. 预期效果：得到授权后，用户在个人门户页面可看到该应用，点击该应用可以以当前登录人员信息单点登录至该单点应用。

   ![1](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/1.png?raw=true)

## 操作指引

我们提供了多个维度为单点登录应用授权的能力，授权相关操作主要分为：  

1. 全量授权方式：支持通过**全量分配**使进入企业下所有用户自动拥有某应用的权限；
2. 部分授权方式：支持通过**人员/部门/用户组/白规则**多种方式对部分用户进行应用授权；
3. 权限黑名单：支持通过**黑规则**的方式保证某些用户始终无法获得应用权限；
4. 权限来源查询：查看某个用户是否拥有某应用权限及权限来源方式明细；

其中，授权方式优先级为**全量分配** > **黑规则**> **人员/部门/用户组/白规则**，当人员被离职时将自动失去所有应用的权限。

## 详细步骤

### 按全量分配授权

若某个应用为全企业员工均可访问，可使用该方式进行授权。

* 全量分配优先级最高，全量分配后其他权限分配方式及黑规则将不再生效及不可使用；
* 取消全量分配后，其他权限分配方式及黑规则将再次恢复；

**操作步骤**

1. 以超级管理员或应用实例管理员账号登录玉符IDaaS管理平台。

2. 在左侧导航栏，单击**应用** > **应用管理**，点击某应用进入该应用详情页。

3. 在右上角，单击**...** > **全量分配**，完成二次确认后全量分配完成。此时所有用户在门户页可以看到该应用，所有新入职的员工将自动获得该应用权限。

   ![image-20210105181932771](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210105181932771.png?raw=true)

4. 在右上角，全量分配情况下单击**...** > **取消全量分配**，完成二次确认后全量分配取消完成。

   ![image-20210105182253288](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210105182253288.png?raw=true)

   

### 按人员/部门/用户组/白规则授权

若某个应用为部分员工可访问，可按照个人需要使用以下几类授权方式：

* **人员**：通过选择人员，授权某用户可以访问该应用；
* **部分**：通过选择部门，授权某部门下的用户可以访问该应用。后续进入该部门的用户将自动拥有权限；
* **用户组**：通过选择用户组，授权某用户组下的用户可以访问该应用。后续进入该用户组的用户将自动拥有权限；
* **白规则**：通过人员属性灵活指定特殊规则，授权满足某规则范围内的用户可以访问该应用。后续满足该规则的用户将自动拥有权限；

以上授权方式之间相互不受影响，即用户权限可以同时来自多种方式，移除时也需各自进行移除。

**操作步骤**

1. 以超级管理员或应用实例管理员账号登录玉符IDaaS管理平台。

2. 在左侧导航栏，单击**应用** > **应用管理**，点击某应用进入该应用详情页。

   ![image-20210105185523116](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210105185523116.png?raw=true)

3. **按人员授权**：

   * 若此时未分配过任何人员，单击人员卡片**添加人员**，支持通过显示名、用户名、手机号、主邮箱、工号信息模糊搜索人员进行添加；

   ![image-20210106134642708](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106134642708.png?raw=true)

   * 若此时已分配过人员，单击人员卡片可查看已分配人员列表，支持在列表进行对已分配人员的搜索、移除及未分配人员的添加操作；

   ![image-20210106134748485](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106134748485.png?raw=true)

   * 除应用侧外，我们也支持在人员侧进行应用权限的添加。详细操作请参考人员操作，此时授权方式同人员授权记为人员手动分配；

   ![image-20210106135126777](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106135126777.png?raw=true)

   

4. **按部门授权**：

   1. 若此时未分配过任何部门，单击部门卡片**添加部门**，支持通过部门名称模糊搜索及通过部门树进行添加；

      ![image-20210106135835479](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106135835479.png?raw=true)

   2. 选择部门时支持选择是否添加子孙部门。若是，选择该部门代表将该部门及其子孙部门的人员均授予权限；若否，选择该部门代表将仅将直属该部门的人员均授予权限；

      * 模糊搜索添加部门通过二次确认选择：

      ![image-20210106140353131](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106140353131.png?raw=true)

      * 部门树添加部门通过切换部门选中颜色选择：

      ![image-20210106140502138](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106140502138.png?raw=true)

   3. 若此时已分配过部门，单击部门卡片可查看已分配部门列表，支持在列表进行对已分配部门的搜索、移除及未分配部门的添加操作；

      通过部门继承关系分配的部门无法直接移除，只能移除直接分配的部门。

      ![image-20210106140926084](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106140926084.png?raw=true)

   4. 除应用侧外，我们也支持在部门侧进行应用权限的添加。详细操作请参考部门操作，此时授权方式同部门授权记为部门分配；

      ![image-20210106143039821](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106143039821.png?raw=true)

5. **按用户组授权**：

   1. 若此时未分配过任何用户组，单击用户组卡片**添加用户组**，支持通过用户组名称模糊搜索用户组进行添加；

      ![image-20210106144330790](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106144330790.png?raw=true)

   2. 若此时已分配过用户组，单击用户组卡片可查看已分配用户组列表，支持在列表进行对已分配用户组的搜索、移除及未分配用户组的添加操作；

      ![image-20210106144409481](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106144409481.png?raw=true)

   3. 除应用侧外，我们也支持在用户组侧进行应用权限的添加。详细操作请参考用户组操作，此时授权方式同用户组授权记为用户组分配；

      ![image-20210106144524575](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106144524575.png?raw=true)

6. **按白规则授权**：

   1. 若此时未创建过任何白规则，单击白规则卡片**添加规则**，白规则支持通过迭加人员各属性划分人员范围，详情说明如下：

      * 1条规则支持添加最多5条筛选项，一条规则的每条筛选项之间取交集（And，并且），每条规则之间取并集（Or，或）。
      * 满足规则的人员不断自动加入权限范围；
      * 筛选项说明如下：

      | 筛选项   | 说明                                                         |
      | -------- | ------------------------------------------------------------ |
      | 人员属性 | 不同数据类型的属性处理条件不同。string/number/integer类型支持【是以下其中之一】、【包含】、【开始于】、【结束于】；Array/foreignkey类型支持【元素包含以下其中之一】，其中foreignkey可进行对应对象数据的模糊搜索 |
      | 直属部门 | 命中该部门下的直属人员，可以通过部门名称进行部门的模糊搜索，最多输入20个部门 |
      | 用户组   | 命中该用户组下的直属人员，可以通过部门名称进行部门的模糊搜索，最多输入20个部门 |

      ![image-20210106151044435](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106151044435.png?raw=true)

   2. 规则的创建编辑中提供预览功能，可通过模糊搜索某人员是否被当前规则命中，已测试规则的正确性；

      ![image-20210106151436790](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106151436790.png?raw=true)

   3. 若此时已创建过白规则，单击白规则卡片可查看已创建规则列表，支持在列表进行对已有规则停用/启用、分配明细及规则的添加操作：

      * 停用：即暂停，已通过该规则加入的人员依然有效，但后续添加、同步、导入的人员不会自动加入该范围；
      * 启用：重新计算符合编辑后规则的人员加入，后续添加、同步、导入的人员符合规则自动加入；
      * 分配明细：此时通过该白规则添加授权的人员；

      ![image-20210106152032121](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106152032121.png?raw=true)

      

   4. 点击某规则进入详情页，在右下角进行规则删除操作。

      ![image-20210106152220431](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106152220431.png?raw=true)



### 按黑规则剔除权限

若某个应用要求部分员工始终不可以访问，可使用该方式进行权限剔除：

* 黑规则优先级高于人员/部门/用户组/白规则，黑规则命中的用户无法通过人员/部门/用户组/白规则方式添加权限；

**操作步骤**

1. 以超级管理员或应用实例管理员账号登录玉符IDaaS管理平台。

2. 在左侧导航栏，单击**应用** > **应用管理**，点击某应用进入该应用详情页。

3. 若此时未创建过任何黑规则，单击黑规则卡片**添加规则**，黑规则支持通过迭加人员各属性划分人员范围，详情说明如下：

   * 1条规则支持添加最多5条筛选项，一条规则的每条筛选项之间取交集（And，并且），每条规则之间取并集（Or，或）。

   * 满足规则的人员不断自动加入权限范围；

   * 筛选项说明如下：

     | 筛选项   | 说明                                                         |
     | -------- | ------------------------------------------------------------ |
     | 人员属性 | 同白规则。不同数据类型的属性处理条件不同。string/number/integer类型支持【是以下其中之一】、【包含】、【开始于】、【结束于】；Array/foreignkey类型支持【元素包含以下其中之一】，其中foreignkey可进行对应对象数据的模糊搜索 |
     | 直属部门 | 同白规则。命中该部门下的直属人员，可以通过部门名称进行部门的模糊搜索，最多输入20个部门 |
     | 用户组   | 同白规则。命中该用户组下的直属人员，可以通过部门名称进行部门的模糊搜索，最多输入20个部门 |
     | 人员     | 仅黑规则有。可以通过显示名、用户名、手机号、主邮箱、工号信息进行人员的模糊搜索，最多输入20个人员 |
     | 部门     | 仅黑规则有。命中该部门及其子孙部门下的所有人员，可以通过部门名称进行人员的模糊搜索 |

![image-20210106153028188](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106153028188.png?raw=true)

4. 规则的创建编辑中提供预览功能，可通过模糊搜索某人员是否被当前规则命中，已测试规则的正确性；
5. 若此时已创建过黑规则，单击黑规则卡片可查看已创建规则列表，支持在列表进行对已有规则停用/启用、分配明细及规则的添加操作：
   * 停用：该黑规则将不再生效，若人员被部门、用户组、白规则命中将重新自动获取授权；
   * 启用：重新计算符合编辑后规则的人员范围，剔除该范围内人员的应用权限；
   * 分配明细：此时通过该黑规则命中人员；
6. 点击某规则进入详情页，在右下角进行规则删除操作。

### 权限查询

帮助管理员快速查找某员工的权限情况，是否拥有权限及权限的来源明细。

**操作步骤**

1. 以超级管理员或应用实例管理员账号登录玉符IDaaS管理平台。

2. 在左侧导航栏，单击**应用** > **应用管理**，点击某应用进入该应用详情页。

3. 在右上角，单击**权限查询** ，此时可通过显示名、用户名、手机号、主邮箱、工号信息进行企业全部人员的模糊搜索。

   ![image-20210106154145450](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106154145450.png?raw=true)

4. 单击搜索结果中的某人员可以查看该人员的权限情况。

   ![image-20210106154234504](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106154234504.png?raw=true)

   ![image-20210106154301212](https://github.com/tonitonishier/Operation-Manual/blob/main/%E7%8E%89%E7%AC%A6%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E6%8E%88%E6%9D%83%E5%9B%BE/image-20210106154301212.png?raw=true)

